<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <title>Time Pokémon OBS (Overlay)</title>
    <!-- Inclui a biblioteca Socket.io do backend -->
    <script src="/socket.io/socket.io.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: transparent;
            /* Fundo transparente para o OBS */
            height: 100vh;
            overflow: hidden;
            font-family: Arial, sans-serif;
        }

        #slots-container {
            position: absolute;
            left: 8.5%;
            /* Push slightly further right */
            bottom: 2%;
            /* Sits very close to the bottom edge */
            width: 58%;
            /* The pokeballs take up roughly 58% of the full 1080p width */
            height: 15%;
            /* Container height */
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .slot {
            width: 15%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        .pokeball {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 90%;
            aspect-ratio: 1;
            background: linear-gradient(to bottom, #ff3333 48%, #333 48%, #333 52%, #fff 52%);
            border-radius: 50%;
            border: 4px solid #333;
            box-sizing: border-box;
            box-shadow: 2px 3px 5px rgba(0, 0, 0, 0.4);
            z-index: 1;
        }

        .pokeball::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 25%;
            height: 25%;
            background: #fff;
            border-radius: 50%;
            border: 4px solid #333;
            box-sizing: border-box;
        }

        .pokemon-img {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -55%);
            /* Sits exactly in the center, pushed just slightly up */
            width: 100%;
            /* Same width as pokeball roughly */
            height: 100%;
            object-fit: contain;
            filter: drop-shadow(2px 3px 5px rgba(0, 0, 0, 0.6));
            display: none;
            transition: all 0.3s ease;
            z-index: 2;
        }

        /* Animaçãozinha leve quando um pokemon entra no time */
        .fade-in {
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: scale(0.8);
            }

            to {
                opacity: 1;
                transform: scale(1);
            }
        }
    </style>
</head>

<body>

    <div id="slots-container"></div>

    <script>
        // Cria a interface no HTML
        const container = document.getElementById('slots-container');
        container.innerHTML = Array.from({ length: 6 }, (_, i) => `
            <div class="slot">
                <div class="pokeball"></div>
                <img id="poke-${i}" class="pokemon-img" src="" alt="Pokemon ${i + 1}">
            </div>
        `).join('');

        // Conecta ao servidor (mesmo domínio/porta)
        const socket = io();

        // O servidor avisa que a equipe mudou (recebe todos os 6)
        socket.on('teamUpdate', (team) => {
            console.log("Time atualizado recebido do Admin:", team);
            team.forEach((pokemonName, index) => {
                atualizarImagem(index, pokemonName);
            });
        });

        // Lógica de carregar as imagens
        function atualizarImagem(index, identificador) {
            let img = document.getElementById('poke-' + index);

            // Se veio vazio, limpa e esconde
            if (!identificador || identificador.trim() === "") {
                img.style.display = 'none';
                img.src = "";
                return;
            }

            identificador = identificador.toLowerCase().trim();

            // Verifica se a imagem já é essa pra não ficar piscando à toa
            const novaSrcGIF = `https://play.pokemonshowdown.com/sprites/ani/${identificador}.gif`;
            if (img.src === novaSrcGIF) return;

            img.style.display = 'block';
            img.classList.remove('fade-in');

            // Força a animação de entrada
            void img.offsetWidth;
            img.classList.add('fade-in');

            // Primeiro tenta GIF animado do Showdown
            img.src = novaSrcGIF;

            // Se falhar o GIF, tenta a PNG do PokeAPI
            img.onerror = function () {
                if (this.src.includes('showdown')) {
                    this.src = `https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/${identificador}.png`;
                } else {
                    // Se falhar tudo (nome errado), esconde
                    this.style.display = 'none';
                }
            };
        }
    </script>
</body>

</html>