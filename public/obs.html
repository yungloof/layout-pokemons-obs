<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <title>Time Pokémon OBS (Overlay)</title>
    <!-- Inclui a biblioteca Socket.io do backend -->
    <script src="/socket.io/socket.io.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: transparent;
            /* Fundo transparente para o OBS */
            height: 100vh;
            overflow: hidden;
            font-family: Arial, sans-serif;
        }

        #slots-container {
            position: absolute;
            left: 5%;
            /* Aligns with the first pokeball */
            bottom: 3%;
            /* Distance from bottom of screen to pokeballs */
            width: 70%;
            /* Box spanning the 6 pokeballs */
            height: 15%;
            /* Height of the pokeballs */
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .slot {
            width: 14%;
            /* 100% / 6 pokeballs = ~16%, minus some gap */
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        .pokemon-img {
            max-width: 130%;
            max-height: 130%;
            object-fit: contain;
            filter: drop-shadow(2px 3px 5px rgba(0, 0, 0, 0.6));
            display: none;
            position: relative;
            bottom: 25px;
            /* Adjust this value if they float too high/low */
            transition: all 0.3s ease;
        }

        /* Animaçãozinha leve quando um pokemon entra no time */
        .fade-in {
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: scale(0.8);
            }

            to {
                opacity: 1;
                transform: scale(1);
            }
        }
    </style>
</head>

<body>

    <div id="slots-container"></div>

    <script>
        // Cria a interface no HTML
        const container = document.getElementById('slots-container');
        container.innerHTML = Array.from({ length: 6 }, (_, i) => `
            <div class="slot">
                <img id="poke-${i}" class="pokemon-img" src="" alt="Pokemon ${i + 1}">
            </div>
        `).join('');

        // Conecta ao servidor (mesmo domínio/porta)
        const socket = io();

        // O servidor avisa que a equipe mudou (recebe todos os 6)
        socket.on('teamUpdate', (team) => {
            console.log("Time atualizado recebido do Admin:", team);
            team.forEach((pokemonName, index) => {
                atualizarImagem(index, pokemonName);
            });
        });

        // Lógica de carregar as imagens
        function atualizarImagem(index, identificador) {
            let img = document.getElementById('poke-' + index);

            // Se veio vazio, limpa e esconde
            if (!identificador || identificador.trim() === "") {
                img.style.display = 'none';
                img.src = "";
                return;
            }

            identificador = identificador.toLowerCase().trim();

            // Verifica se a imagem já é essa pra não ficar piscando à toa
            const novaSrcGIF = `https://play.pokemonshowdown.com/sprites/ani/${identificador}.gif`;
            if (img.src === novaSrcGIF) return;

            img.style.display = 'block';
            img.classList.remove('fade-in');

            // Força a animação de entrada
            void img.offsetWidth;
            img.classList.add('fade-in');

            // Primeiro tenta GIF animado do Showdown
            img.src = novaSrcGIF;

            // Se falhar o GIF, tenta a PNG do PokeAPI
            img.onerror = function () {
                if (this.src.includes('showdown')) {
                    this.src = `https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/${identificador}.png`;
                } else {
                    // Se falhar tudo (nome errado), esconde
                    this.style.display = 'none';
                }
            };
        }
    </script>
</body>

</html>